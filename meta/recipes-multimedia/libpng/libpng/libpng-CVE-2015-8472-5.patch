From 9f2ad4928e47036cf1ac9b8fe45a491f15be2324 Mon Sep 17 00:00:00 2001
From: Glenn Randers-Pehrson <glennrp at users.sourceforge.net>
Date: Wed, 4 Nov 2015 23:47:42 -0600
Subject: [PATCH] [libpng16] Fixed new bug with CRC error after reading an
 over-length palette.

Upstream-Status: Backport

Signed-off-by: Yue Tao <yue.tao@windriver.com>

---
 pngrutil.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pngrutil.c b/pngrutil.c
index 6d35445..a006199 100644
--- a/pngrutil.c
+++ b/pngrutil.c
@@ -975,7 +975,7 @@ png_handle_PLTE(png_structrp png_ptr, png_inforp info_ptr, png_uint_32 length)
    if (png_ptr->color_type == PNG_COLOR_TYPE_PALETTE)
 #endif
    {
-      png_crc_finish(png_ptr, 0);
+      png_crc_finish(png_ptr, (int) length - num * 3);
    }
 
 #ifndef PNG_READ_OPT_PLTE_SUPPORTED
-- 
1.7.9.5

